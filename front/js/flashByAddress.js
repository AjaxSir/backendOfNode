import{z as Le,aP as Te,s as L,W as Ee,w as q,aR as Ne,Y as We,aS as Ue,B as v,D as m,E as t,N as _,O as u,H as r,at as f,aa as b,au as I,av as k,a9 as G,F as E,aI as N,a8 as W,J as w,P as J,aU as z,b4 as Ie,aW as x,aQ as C,aV as Q,aX as Ae,b0 as Oe,b1 as $e,b2 as ke,b3 as D,b5 as we}from"../index.js";import{E as ze}from"./overlay.js";import{E as xe,a as De,b as Me}from"./autocomplete.js";import{E as Re}from"./checkbox.js";import{u as qe,l as Ge,n as Je,E as Xe,r as je}from"./hookOfFlash.js";const S=A=>(Oe("data-v-ff7a77d2"),A=A(),$e(),A),He={class:"header"},Qe={class:"head-item"},Ye=S(()=>t("br",null,null,-1)),Ke={class:"head-item"},Ze=S(()=>t("br",null,null,-1)),el={key:0,class:"initializing"},ll={class:"collapse-title"},al={key:0,class:"progress_percent"},sl={key:1,class:"progress_failed_title"},ol={class:"inner_progress"},tl={class:"inner_progress"},nl={class:"config trans-channel"},rl={class:"title"},il={class:"cont"},ul=S(()=>t("span",{class:"required"},"*",-1)),cl=S(()=>t("br",null,null,-1)),dl=S(()=>t("span",{class:"required"},"*",-1)),hl=S(()=>t("br",null,null,-1)),pl=S(()=>t("span",{class:"required"},"*",-1)),fl=S(()=>t("br",null,null,-1)),_l=S(()=>t("span",{class:"required"},"*",-1)),vl=S(()=>t("br",null,null,-1)),bl=["src"],ml={key:1},gl={class:"config flash-address"},Bl=S(()=>t("div",{class:"title"},"Flash",-1)),Sl={class:"cont vertical"},yl={class:"flash-item"},Vl=S(()=>t("span",{class:"required"},"*",-1)),Pl={key:0,class:"flash-item"},Fl=S(()=>t("span",{class:"required"},"*",-1)),Cl={class:"flash-item"},Ll=S(()=>t("span",{class:"required"},"*",-1)),Tl={key:0,class:"actual_size"},El={key:0},Nl={class:"dialog-footer"},Wl=Le({__name:"flashByAddress",emits:["changeFlashing"],setup(A,{emit:Y}){const{SelectBinPath:K,getFlashByAddressInfo:Z,saveFlashByAddressInfo:ee,openDysncLogFile:le,isExistFileAndReturnSize:X,saveFlashByAddressOptions:ae,getFlashByAddressOptions:se}=ke,{isSerialPortRefresh:oe,serialPortList:P,getSerialPort:j,maxWidth:te}=qe(),{t:l}=Te(),ne=Y,g=L(!1),V=L("Burn"),d=L(0),O=L([0]),U=L(!1),$=L(!1);let T=Ee({StartPosition:[],Length:[],BinFilePath:[]}),p=L([{selectLabel:l("flashByWhole.single_board"),selectValue:0,children:[{BoardName:l("flashByWhole.single_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",StartPosition:"",Length:"",IsBurnByAddress:!0,binFileSize:"",percentage:0,status:"ready",SOCType:1,BoardType:1,isActualFileSize:!1}]},{selectLabel:l("flashByWhole.double_board"),selectValue:1,children:[{BoardName:l("flashByWhole.A_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",StartPosition:"",Length:"",IsBurnByAddress:!0,binFileSize:"",percentage:0,status:"ready",SOCType:1,BoardType:1,isActualFileSize:!1},{BoardName:l("flashByWhole.B_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",StartPosition:"",Length:"",IsBurnByAddress:!0,binFileSize:"",percentage:0,status:"ready",SOCType:1,BoardType:1,isActualFileSize:!1}]}]);const re=(o,e)=>{o?e.Length=e.BinFilePath&&e.binFileSize||"":e.Length=""},H=()=>{z.open(l("common.cancel_flash_ing")),Je(B.value).then(()=>{p.value[d.value].children.forEach(o=>{o.status="failed"}),g.value=!1}).finally(()=>{z.close()})},ie=(o,e)=>{const n=T.StartPosition.filter(i=>i.label.toLowerCase().indexOf(o.toLowerCase())===0);e(n)},ue=(o,e,n)=>{const i=p.value[d.value].children[e];i.StartPosition=o.value,i.Length=o.infos.Length,i.BinFilePath=o.infos.BinFilePath},ce=(o,e)=>{const n=T.Length.filter(i=>i.label.toLowerCase().indexOf(o.toLowerCase())===0);e(n)},de=(o,e)=>{const n=p.value[d.value].children[e];n.Length=o.value},he=(o,e)=>{const n=T.BinFilePath.filter(i=>i.label.toLowerCase().indexOf(o.toLowerCase())===0);e(n)},pe=async(o,e)=>{const n=p.value[d.value].children[e],{binSize:i}=await X(o.value||"");i==-1?(Ie.error(`BIN: ${o.value} ${l("flashByWhole.not_exit")}`),n.BinFilePath=""):(n.BinFilePath=o.value,n.isActualFileSize&&(n.Length=`0x${Number(i).toString(16)}`))},B=q(()=>V.value==="Burn"),fe=o=>{j(!0).then(()=>{if(o){let e=!1;P.value.forEach(n=>{n.Value==o.SerialPort.Value&&(n.Disabled=!1,e=!0)}),o.SerialPort.Value=e?o.SerialPort.Value:""}})},_e=(o,e)=>{P.value.forEach(n=>{n.Value==e&&(n.Disabled=!o)})},ve=o=>{O.value=o==0?[0]:[],P.value.forEach(e=>{e.Disabled=!1})},be=o=>{P.value.forEach(e=>{e.Disabled=e.Value===o})},me=async()=>{const o=p.value[d.value].children;let e=[{boardName:"",errorMsg:[],isInputWhole:!1},{boardName:"",errorMsg:[],isInputWhole:!1}],n="";for(let a=0;a<o.length;a++){const h=o[a];e[a].boardName=h.BoardName,!/(?:^0$|^0x[\da-fA-F]+$)/.test(h.StartPosition)&&h.StartPosition!="0"&&e[a].errorMsg.push(`${l("flashByWhole.please_input_16_address")}  <br />`),/(?:^0$|^0x[\da-fA-F]+$)/.test(h.Length)||e[a].errorMsg.push(`${l("flashByWhole.please_input_16_length")} <br />`);const{binSize:y}=await X(h.BinFilePath||"");y==-1&&h.BinFilePath&&V.value==="Burn"?(e[a].errorMsg.push(`BIN: ${o[a].BinFilePath} ${l("flashByWhole.not_exit")} <br />`),h.binFileSize="0"):h.binFileSize=`0x${Number(y).toString(16)}`,h.binFileSize!==h.Length&&B.value&&y!=-1&&e[a].errorMsg.push(`${l("flashByWhole.not_equal_bin_length")}${l("flashByWhole.bin_file_size")}: ${h.binFileSize||0},${l("flashByWhole.length_hex")}:${h.Length||0}; <br />`),B.value?e[a].isInputWhole=!!(h.BinFilePath&&h.SerialPort.Value&&h.binFileSize&&h.StartPosition&&h.Length):e[a].isInputWhole=!!(h.SerialPort.Value&&h.StartPosition&&h.Length)}console.error(e,"errObj");const i=e.some(a=>a.errorMsg.length&&a.isInputWhole);return i&&e.forEach(a=>{a.errorMsg.length&&a.isInputWhole&&(n+=`<span class='error-title'>${a.boardName}:</span> <br />`,a.errorMsg.forEach(h=>{n+=h}))}),{flag:i,str:n}},ge=async o=>{const{binPath:e,binSize:n}=await K();console.log(`0x${Number(n).toString(16)}`),o.BinFilePath=e,o.isActualFileSize&&(o.Length=`0x${Number(n).toString(16)}`),o.binFileSize=`0x${Number(n).toString(16)}`},Be=async()=>{const{flag:o,str:e}=await me();if(o)return x.error(e,l("common.tips"),l("common.confirm"),"");U.value=!0},M=q(()=>B.value?p.value[d.value].children.filter(o=>o.BinFilePath&&o.SerialPort.Value&&o.StartPosition&&o.Length):p.value[d.value].children.filter(o=>o.SerialPort.Value&&o.StartPosition&&o.Length)),Se=()=>{U.value=!1,g.value=!0;const o=B.value?C.Protobuf.BSTFlashInterface.BurnFLash:C.Protobuf.BSTFlashInterface.EraseFlash;p.value[d.value].children.forEach(e=>{var n;return e.status="ready",e.percentage=0,e.Usb.Name=e.SOCType===1?e.Usb.Value==="0"?"USB2.0":"USB3.0":e.Usb.Value==="0"?"Type_C":"Type_A",e.SerialPort.Name=((n=P.value.find(i=>i.Value===e.SerialPort.Value))==null?void 0:n.Name)||"",e}),ee(JSON.stringify({flashOptions:p.value,deviceType:d.value,actionType:V.value})),ae(ye()),Q.send({functionId:o,data:{BurnFlashSetting:M.value}}).then(e=>{var n;if(z.close(),g.value=!1,e.Result)console.log(e,"IBurnFlashR"),p.value[d.value].children.forEach(i=>{e.ChildBoard&&e.ChildBoard.forEach(a=>{a.BoardName===i.BoardName&&(i.percentage=100)})}),x.success(e.message||`${B.value?l("flashByWhole.flash"):l("flashByWhole.erase")} Flash ${l("common.success")}`,l("common.tips"),l("common.confirm"),"");else{let i=`${e.message} <br>`;(n=e.ChildBoard)==null||n.forEach(a=>{d.value?a.FlashStatus===C.Protobuf.BurnFlashStatus.Failure?(i+=`${a.Message} <br>`,a.BoardName=="A子板"||a.BoardName=="A board"?p.value[d.value].children[0].status="failed":p.value[d.value].children[1].status="failed"):a.FlashStatus===C.Protobuf.BurnFlashStatus.Succeed&&(a.BoardName=="A子板"||a.BoardName=="A board"?p.value[d.value].children[0].percentage=100:p.value[d.value].children[1].percentage=100):a.FlashStatus===C.Protobuf.BurnFlashStatus.Failure&&(p.value[d.value].children[0].status="failed",i+=`${a.Message} <br>`)}),x.error(i,l("common.flash_fail"),l("common.confirm"),l("common.view_log")).catch(()=>{Q.send({functionId:C.Protobuf.BSTFlashInterface.GetLogFile,data:{}}).then(a=>{le(a.Path)})})}$.value=!1}).catch(()=>{p.value[d.value].children.forEach(e=>{e.status="failed"})})},ye=()=>{const o=p.value[d.value].children;let e=[],n=[],i=[];return o.forEach(a=>{e.includes(a.StartPosition)||e.push(a.StartPosition),n.includes(a.Length)||n.push(a.Length),i.includes(a.BinFilePath)||i.push(a.BinFilePath)}),{StartPosition:e,Length:n,BinFilePath:i}};Ne(async()=>{D.on("FlashOperationStatus",a=>{var h;a.FlashStatus===C.Protobuf.BurnFlashStatus.Initialize?$.value=!0:($.value=!1,d.value?(h=a.ChildBoard)==null||h.forEach(y=>{y.BoardName=="A子板"||y.BoardName=="A board"?(p.value[d.value].children[0].percentage=y.Progress,p.value[d.value].children[0].status=y.FlashStatus===4?"failed":""):(p.value[d.value].children[1].percentage=y.Progress,p.value[d.value].children[1].status=y.FlashStatus===4?"failed":"")}):(p.value[d.value].children[0].percentage=a.ChildBoard?a.ChildBoard[0].Progress:0,p.value[d.value].children[0].status=a.ChildBoard&&a.ChildBoard[0].FlashStatus===4?"failed":""))}),D.on("StartFlashR",a=>{a.UserInstructionTips===C.Protobuf.UserInstructionTips.RESET_TIPS&&(z.close(),x.info(B.value?l("flash.please_reset_board"):l("flash.please_reset_board_earse"),l("common.tips"),B.value?l("common.continue_flash"):l("flashByWhole.continue_erase"),B.value?l("common.cancel_flash"):l("flashByWhole.cancel_erase")).then(()=>{}).catch(()=>{H()}))}),await j();const o=await Z(),e=JSON.parse(o);p.value=e?e.flashOptions:p.value,d.value=e?e.deviceType:d.value,V.value=e?e.actionType:V.value,O.value=d.value==0?[0]:[];const n=P.value.map(a=>a.Value);p.value[d.value].children.forEach(a=>{n.includes(a.SerialPort.Value)||(a.SerialPort.Value=""),P.value.forEach(h=>{a.SerialPort.Value===h.Value&&(h.Disabled=!0)}),a.SOCType=a.SOCType||1,a.BoardType=a.BoardType||1});const i=await se();T.Length=i.Length.map(a=>({label:a,value:a})),T.BinFilePath=i.BinFilePath.map(a=>({label:a,value:a})),T.StartPosition=i.StartPosition});const R=q(()=>sessionStorage.getItem("lang")==="en");return We(g,(o,e)=>{ne("changeFlashing",o)}),Ue(()=>{D.off("FlashOperationStatus"),D.off("StartFlashR")}),(o,e)=>{const n=Xe,i=je,a=Ae,h=xe,y=Re,Ve=De,Pe=Me,Fe=ze;return v(),m(I,null,[t("div",He,[t("div",Qe,[_(u(r(l)("flashByWhole.device_type"))+" ",1),Ye,f(i,{"popper-class":"select-class",onChange:ve,disabled:g.value,modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:r(l)("common.please_select")},{default:b(()=>[(v(!0),m(I,null,k(r(p),(s,F)=>(v(),G(n,{key:F,label:s.selectLabel,value:s.selectValue},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue","placeholder"])]),t("div",Ke,[_(u(r(l)("flashByWhole.action_type"))+" ",1),Ze,f(i,{"popper-class":"select-class",disabled:g.value,modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=s=>V.value=s),placeholder:r(l)("common.please_select")},{default:b(()=>[f(n,{label:r(l)("flashByWhole.flash"),value:"Burn"},null,8,["label"]),f(n,{label:r(l)("flashByWhole.erase"),value:"Erase"},null,8,["label"])]),_:1},8,["disabled","modelValue","placeholder"])]),E(f(a,{disabled:!M.value.length||g.value,class:"start-flash",onClick:Be},{default:b(()=>[_(u(B.value?r(l)("common.start_flash"):r(l)("common.start_erase")),1)]),_:1},8,["disabled"]),[[N,!g.value]]),E(f(a,{class:"start-flash",onClick:H},{default:b(()=>[_(u(B.value?r(l)("common.cancel_flash"):r(l)("flashByWhole.cancel_erase")),1)]),_:1},512),[[N,g.value]])]),$.value?(v(),m("div",el,u(r(l)("flashByWhole.Initializing")),1)):W("",!0),f(Pe,{modelValue:O.value,"onUpdate:modelValue":e[2]||(e[2]=s=>O.value=s)},{default:b(()=>[(v(!0),m(I,null,k(r(p)[d.value].children,(s,F)=>(v(),G(Ve,{key:F,name:F,class:w(s.status=="failed"&&"collapse_failed")},{title:b(()=>[t("span",ll,u(s.BoardName),1),s.percentage&&s.status!=="failed"?(v(),m("span",al,u(s.percentage)+"%",1)):W("",!0),s.percentage&&s.status=="failed"?(v(),m("span",sl,u(s.percentage)+"%",1)):W("",!0),s.status!=="failed"?(v(),m("div",{key:2,class:"progress",style:J({width:`${s.percentage}%`})},[E(t("div",ol,null,512),[[N,s.percentage!=100]]),E(t("div",tl,null,512),[[N,s.percentage!=100]])],4)):(v(),m("div",{key:3,class:"progress progress_failed",style:J({width:`${s.percentage}%`})},null,4))]),default:b(()=>[t("div",nl,[t("div",rl,u(r(l)("common.transport_channel")),1),t("div",il,[t("div",null,[t("span",null,[ul,_(" "+u(r(l)("getVerison.board_type")),1)]),_(),cl,f(i,{class:"device",disabled:g.value,"popper-class":"select-class",modelValue:s.SOCType,"onUpdate:modelValue":c=>s.SOCType=c,placeholder:r(l)("common.please_select")},{default:b(()=>[f(n,{label:"A1000B",value:1}),f(n,{label:"C1200",value:2})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),E(t("div",null,[t("span",null,[dl,_(" "+u(r(l)("flashByWhole.board_type")),1)]),_(),hl,f(i,{class:"device",disabled:g.value,"popper-class":"select-class",modelValue:s.BoardType,"onUpdate:modelValue":c=>s.BoardType=c,placeholder:r(l)("common.please_select")},{default:b(()=>[f(n,{label:"EVM_LPDDR4X",value:1}),f(n,{label:"EVM_LPDDR5",value:2}),f(n,{label:"CDCU_LPDDR5",value:3})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])],512),[[N,s.SOCType===2]]),t("div",null,[t("span",null,[pl,_(" "+u(r(l)("common.usb")),1)]),fl,f(i,{"popper-class":"select-class",class:"usb",disabled:g.value,modelValue:s.Usb.Value,"onUpdate:modelValue":c=>s.Usb.Value=c,placeholder:r(l)("common.please_select")},{default:b(()=>[f(n,{label:s.SOCType===1?"USB2.0":"Type_C",value:"0"},null,8,["label"]),f(n,{label:s.SOCType===1?"USB3.0":"Type_A",value:"1"},null,8,["label"])]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),t("div",null,[t("span",null,[_l,_(" "+u(r(l)("common.serial_port")),1)]),vl,f(a,{onClick:c=>fe(s),disabled:g.value,type:"primary",class:"refresh"},{default:b(()=>[r(oe)?(v(),m("img",{key:0,src:r(Ge),alt:"",srcset:""},null,8,bl)):(v(),m("span",ml,u(r(l)("common.refresh")),1))]),_:2},1032,["onClick","disabled"]),f(i,{"popper-class":"select-class",clearable:"",class:"port",style:J({width:r(te)}),disabled:g.value,modelValue:s.SerialPort.Value,"onUpdate:modelValue":c=>s.SerialPort.Value=c,onVisibleChange:c=>_e(c,s.SerialPort.Value),onChange:be,placeholder:r(l)("common.please_select")},{default:b(()=>[(v(!0),m(I,null,k(r(P),c=>(v(),G(n,{disabled:!!c.Disabled,key:c.Value,label:c.Name,value:c.Value},null,8,["disabled","label","value"]))),128))]),_:2},1032,["style","disabled","modelValue","onUpdate:modelValue","onVisibleChange","placeholder"])])])]),t("div",gl,[Bl,t("div",Sl,[t("div",yl,[t("span",{class:w(["label",R.value&&"eng"])},[Vl,_(" "+u(r(l)("flashByWhole.address_hex")),1)],2),f(h,{style:{width:"400px"},modelValue:s.StartPosition,"onUpdate:modelValue":c=>s.StartPosition=c,"fetch-suggestions":ie,clearable:"",spellcheck:"false","popper-class":"select-class",class:"inline-input w-50",placeholder:r(l)("common.please_input"),onSelect:c=>ue(c,F,s)},null,8,["modelValue","onUpdate:modelValue","placeholder","onSelect"])]),V.value==="Burn"?(v(),m("div",Pl,[t("span",{class:w(["label",R.value&&"eng"])},[Fl,_(" "+u(r(l)("flashByWhole.BIN_file")),1)],2),f(h,{style:{width:"400px"},modelValue:s.BinFilePath,"onUpdate:modelValue":c=>s.BinFilePath=c,"fetch-suggestions":he,clearable:"",spellcheck:"false","popper-class":"select-class",class:"inline-input w-50",placeholder:r(l)("common.please_input"),onSelect:c=>pe(c,F)},null,8,["modelValue","onUpdate:modelValue","placeholder","onSelect"]),f(a,{disabled:g.value,onClick:c=>ge(s)},{default:b(()=>[_(u(r(l)("common.select_file")),1)]),_:2},1032,["disabled","onClick"])])):W("",!0),t("div",Cl,[t("span",{class:w(["label",R.value&&"eng"])},[Ll,_(" "+u(r(l)("flashByWhole.length_hex")),1)],2),f(h,{disabled:s.isActualFileSize,style:{width:"400px"},spellcheck:"false",modelValue:s.Length,"onUpdate:modelValue":c=>s.Length=c,"fetch-suggestions":ce,clearable:"","popper-class":"select-class",class:"inline-input w-50",placeholder:r(l)("common.please_input"),onSelect:c=>de(c,F)},null,8,["disabled","modelValue","onUpdate:modelValue","placeholder","onSelect"]),V.value=="Burn"?(v(),m("span",Tl,[f(y,{onChange:c=>re(c,s),modelValue:s.isActualFileSize,"onUpdate:modelValue":c=>s.isActualFileSize=c},{default:b(()=>[_(u(r(l)("flashByWhole.actual_size")),1)]),_:2},1032,["onChange","modelValue","onUpdate:modelValue"])])):W("",!0)])])])]),_:2},1032,["name","class"]))),128))]),_:1},8,["modelValue"]),f(Fe,{modelValue:U.value,"onUpdate:modelValue":e[4]||(e[4]=s=>U.value=s),title:B.value?r(l)("flashByWhole.flash_info"):r(l)("flashByWhole.erase_info"),width:"800px",class:"flash-success","close-on-click-modal":!1,"show-close":!1},{footer:b(()=>[t("span",Nl,[f(a,{class:"dialog-btn cancel-btn",type:"primary",onClick:e[3]||(e[3]=s=>U.value=!1)},{default:b(()=>[_(u(B.value?r(l)("common.cancel_flash"):r(l)("flashByWhole.cancel_erase")),1)]),_:1}),f(a,{class:"dialog-btn confirm-btn",onClick:Se,type:"primary"},{default:b(()=>[_(u(B.value?r(l)("common.continue_flash"):r(l)("flashByWhole.continue_erase")),1)]),_:1})])]),default:b(()=>[(v(!0),m(I,null,k(M.value,(s,F)=>{var c;return v(),m("div",{class:"flash-burn-info",key:F},[t("p",null,"[ "+u(s.BoardName)+" ]",1),t("p",null,[t("span",null,u(r(l)("getVerison.board_type"))+":",1),_(" "+u(s.SOCType===1?"A1000B":"C1200"),1)]),s.SOCType===2?(v(),m("p",El,[t("span",null,u(r(l)("flashByWhole.board_type"))+":",1),_(" "+u(s.BoardType===1?"EVM_LPDDR4X":s.BoardType===2?"EVM_LPDDR5":"CDCU_LPDDR5"),1)])):W("",!0),t("p",null,[t("span",null,u(r(l)("common.usb"))+":",1),_(" "+u(s.SOCType===1?s.Usb.Value=="0"?"USB2.0":"USB3.0":s.Usb.Value=="0"?"Type_C":"Type_A"),1)]),t("p",null,[t("span",null,u(r(l)("common.serial_port"))+":",1),_(" "+u((c=r(P).find(Ce=>Ce.Value===s.SerialPort.Value))==null?void 0:c.Name),1)]),t("p",null,[t("span",null,u(r(l)("flashByWhole.address_hex"))+":",1),_(" "+u(s.StartPosition),1)]),E(t("p",null,[t("span",null,u(r(l)("flashByWhole.BIN_file"))+":",1),_(" "+u(s.BinFilePath),1)],512),[[N,V.value==="Burn"]]),t("p",null,[t("span",null,u(r(l)("flashByWhole.length_hex"))+":",1),_(" "+u(s.Length),1)])])}),128))]),_:1},8,["modelValue","title"])],64)}}});const kl=we(Wl,[["__scopeId","data-v-ff7a77d2"]]);export{kl as default};
