import{z as Be,aP as ye,s as T,W as ge,w as J,aR as Ve,Y as Se,aS as Pe,B as _,D as b,E as o,N as f,O as c,H as n,at as d,aa as v,au as U,av as w,a9 as x,F as E,aI as N,a8 as I,J as Fe,P as M,aU as A,aW as L,aQ as F,aV as X,aX as Ce,b0 as Te,b1 as Ee,b2 as Ne,b3 as R,b5 as We}from"../index.js";import{E as Ue}from"./overlay.js";import{E as Ie,a as Oe,b as De}from"./autocomplete.js";import{u as ke,l as we,n as Ae,E as Le,r as Re}from"./hookOfFlash.js";const y=O=>(Te("data-v-8523b929"),O=O(),Ee(),O),$e={class:"header"},xe={class:"head-item"},Me=y(()=>o("br",null,null,-1)),ze={class:"head-item"},qe=y(()=>o("br",null,null,-1)),Ge={key:0,class:"initializing"},Je={class:"collapse-title"},Xe={key:0,class:"progress_percent"},je={key:1,class:"progress_failed_title"},He={class:"inner_progress"},Qe={class:"inner_progress"},Ye={class:"config trans-channel"},Ke={class:"title"},Ze={class:"cont"},el=y(()=>o("span",{class:"required"},"*",-1)),ll=y(()=>o("br",null,null,-1)),al=y(()=>o("span",{class:"required"},"*",-1)),sl=y(()=>o("br",null,null,-1)),ol=y(()=>o("span",{class:"required"},"*",-1)),tl=y(()=>o("br",null,null,-1)),nl=y(()=>o("span",{class:"required"},"*",-1)),rl=y(()=>o("br",null,null,-1)),ul=["src"],cl={key:1},il={key:0,class:"config flash-whole"},dl=y(()=>o("div",{class:"title"},"Flash",-1)),hl={class:"cont"},pl={class:"flash-item"},fl={class:"label bin"},_l=y(()=>o("span",{class:"required"},"*",-1)),vl={key:0},ml={class:"dialog-footer"},bl=Be({__name:"flashByWhole",emits:["changeFlashing"],setup(O,{emit:j}){const{SelectBinPath:H,getFlashByWholeInfo:Q,saveFlashByWholeInfo:Y,openDysncLogFile:K,isExistFileAndReturnSize:Z,getFlashByWholeOptions:ee,saveFlashByWholeOptions:le}=Ne,{isSerialPortRefresh:ae,serialPortList:V,getSerialPort:z,maxWidth:se}=ke(),{t:l}=ye(),oe=j,m=T(!1),S=T("Burn"),u=T(0),D=T([0]),W=T(!1),k=T(!1),i=T([{selectLabel:l("flashByWhole.single_board"),selectValue:0,children:[{BoardName:l("flashByWhole.single_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",IsBurnByAddress:!1,percentage:0,status:"ready",SOCType:1,BoardType:1}]},{selectLabel:l("flashByWhole.double_board"),selectValue:1,children:[{BoardName:l("flashByWhole.A_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",IsBurnByAddress:!1,percentage:0,status:"ready",SOCType:1,BoardType:1},{BoardName:l("flashByWhole.B_board"),SerialPort:{Name:"",Value:""},Usb:{Name:"",Value:"0"},BinFilePath:"",IsBurnByAddress:!1,percentage:0,status:"ready",SOCType:1,BoardType:1}]}]);let q=ge({BinFilePath:[]});const te=(t,e)=>{const r=q.BinFilePath.filter(p=>p.label.toLowerCase().indexOf(t.toLowerCase())===0);e(r)},ne=(t,e)=>{const r=i.value[u.value].children[e];r.BinFilePath=t.value},G=()=>{A.open(l("common.cancel_flash_ing")),Ae(B.value).then(()=>{i.value[u.value].children.forEach(t=>{t.status="failed"}),m.value=!1}).finally(()=>{A.close()})},re=t=>{D.value=t==0?[0]:[],V.value.forEach(e=>{e.Disabled=!1})},B=J(()=>S.value==="Burn"),ue=t=>{z(!0).then(()=>{if(t){let e=!1;V.value.forEach(r=>{r.Value==t.SerialPort.Value&&(r.Disabled=!1,e=!0)}),t.SerialPort.Value=e?t.SerialPort.Value:""}})},ce=(t,e)=>{V.value.forEach(r=>{r.Value==e&&(r.Disabled=!t)})},ie=t=>{V.value.forEach(e=>{e.Disabled=e.Value===t})},de=async()=>{const t=i.value[u.value].children;let e=[{boardName:"",errorMsg:[],isInputWhole:!1},{boardName:"",errorMsg:[],isInputWhole:!1}],r="";for(let a=0;a<t.length;a++){const{binSize:g}=await Z(t[a].BinFilePath||"");g==-1&&t[a].BinFilePath&&(e[a].boardName=t[a].BoardName,e[a].errorMsg.push(`BIN: ${t[a].BinFilePath} ${l("flashByWhole.not_exit")} <br />`))}const p=e.some(a=>a.errorMsg.length);return p&&e.forEach(a=>{a.errorMsg.length&&(r+=`<span class='error-title'>${a.boardName}:</span> <br />`,a.errorMsg.forEach(g=>{r+=g}))}),{flag:p,str:r}},he=async t=>{const{binPath:e}=await H();t.BinFilePath=e},pe=async()=>{const{flag:t,str:e}=await de();if(console.error("startFlashOrEraseBefore,",t,e),t)return L.error(e);W.value=!0},$=J(()=>B.value?i.value[u.value].children.filter(t=>t.BinFilePath&&t.SerialPort.Value):i.value[u.value].children.filter(t=>t.SerialPort.Value)),fe=()=>{const t=i.value[u.value].children;let e=[];return t.forEach(r=>{e.includes(r.BinFilePath)||e.push(r.BinFilePath)}),{BinFilePath:e}},_e=()=>{W.value=!1,m.value=!0;const t=B.value?F.Protobuf.BSTFlashInterface.BurnFLash:F.Protobuf.BSTFlashInterface.EraseFlash;i.value[u.value].children.forEach(e=>{var r;return e.status="ready",e.percentage=0,e.Usb.Name=e.SOCType===1?e.Usb.Value==="0"?"USB2.0":"USB3.0":e.Usb.Value==="0"?"Type_C":"Type_A",e.SerialPort.Name=((r=V.value.find(p=>p.Value===e.SerialPort.Value))==null?void 0:r.Name)||"",e}),Y(JSON.stringify({flashOptions:i.value,deviceType:u.value,actionType:S.value})),le(fe()),X.send({functionId:t,data:{BurnFlashSetting:$.value}}).then(e=>{var r;if(A.close(),m.value=!1,e.Result)console.log(e,"IBurnFlashR"),i.value[u.value].children.forEach(p=>{e.ChildBoard&&e.ChildBoard.forEach(a=>{a.BoardName===p.BoardName&&(p.percentage=100)})}),L.success(e.message||`${B.value?l("flashByWhole.flash"):l("flashByWhole.erase")} Flash ${l("common.success")}`,l("common.tips"),l("common.confirm"),"");else{let p=`${e.message} <br>`;(r=e.ChildBoard)==null||r.forEach(a=>{u.value?a.FlashStatus===F.Protobuf.BurnFlashStatus.Failure?(p+=`${a.Message} <br>`,a.BoardName=="A子板"||a.BoardName=="A board"?i.value[u.value].children[0].status="failed":i.value[u.value].children[1].status="failed"):a.FlashStatus===F.Protobuf.BurnFlashStatus.Succeed&&(a.BoardName=="A子板"||a.BoardName=="A board"?i.value[u.value].children[0].percentage=100:i.value[u.value].children[1].percentage=100):a.FlashStatus===F.Protobuf.BurnFlashStatus.Failure&&(i.value[u.value].children[0].status="failed",p+=`${a.Message} <br>`)}),L.error(p,l("common.flash_fail"),l("common.confirm"),l("common.view_log")).catch(()=>{X.send({functionId:F.Protobuf.BSTFlashInterface.GetLogFile,data:{}}).then(a=>{K(a.Path)})})}k.value=!1}).catch(()=>{i.value[u.value].children.forEach(e=>{e.status="failed"})})};return Ve(async()=>{R.on("FlashOperationStatus",a=>{var g;a.FlashStatus===F.Protobuf.BurnFlashStatus.Initialize?k.value=!0:(k.value=!1,u.value?(g=a.ChildBoard)==null||g.forEach(P=>{P.BoardName=="A子板"||P.BoardName=="A board"?(i.value[u.value].children[0].percentage=P.Progress,i.value[u.value].children[0].status=P.FlashStatus===4?"failed":""):(i.value[u.value].children[1].percentage=P.Progress,i.value[u.value].children[1].status=P.FlashStatus===4?"failed":"")}):(i.value[u.value].children[0].percentage=a.ChildBoard?a.ChildBoard[0].Progress:0,i.value[u.value].children[0].status=a.ChildBoard&&a.ChildBoard[0].FlashStatus===4?"failed":""))}),R.on("StartFlashR",a=>{a.UserInstructionTips===F.Protobuf.UserInstructionTips.RESET_TIPS&&(A.close(),L.info(B.value?l("flash.please_reset_board"):l("flash.please_reset_board_earse"),l("common.tips"),B.value?l("common.continue_flash"):l("flashByWhole.continue_erase"),B.value?l("common.cancel_flash"):l("flashByWhole.cancel_erase")).then(()=>{}).catch(()=>{G()}))}),await z();const t=await Q(),e=JSON.parse(t);i.value=e?e.flashOptions:i.value,u.value=e?e.deviceType:u.value,S.value=e?e.actionType:S.value,D.value=u.value==0?[0]:[];const r=V.value.map(a=>a.Value);i.value[u.value].children.forEach(a=>{r.includes(a.SerialPort.Value)||(a.SerialPort.Value=""),V.value.forEach(g=>{a.SerialPort.Value===g.Value&&(g.Disabled=!0)}),a.SOCType=a.SOCType||1,a.BoardType=a.BoardType||1});const p=await ee();q.BinFilePath=p.BinFilePath.map(a=>({label:a,value:a}))}),Se(m,(t,e)=>{oe("changeFlashing",t)}),Pe(()=>{R.off("FlashOperationStatus"),R.off("StartFlashR")}),(t,e)=>{const r=Le,p=Re,a=Ce,g=Ie,P=Oe,ve=De,me=Ue;return _(),b(U,null,[o("div",$e,[o("div",xe,[f(c(n(l)("flashByWhole.device_type"))+" ",1),Me,d(p,{"popper-class":"select-class",disabled:m.value,modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),onChange:re,placeholder:n(l)("common.please_select")},{default:v(()=>[(_(!0),b(U,null,w(i.value,(s,C)=>(_(),x(r,{key:C,label:s.selectLabel,value:s.selectValue},null,8,["label","value"]))),128))]),_:1},8,["disabled","modelValue","placeholder"])]),o("div",ze,[f(c(n(l)("flashByWhole.action_type"))+" ",1),qe,d(p,{"popper-class":"select-class",disabled:m.value,modelValue:S.value,"onUpdate:modelValue":e[1]||(e[1]=s=>S.value=s),placeholder:n(l)("common.please_select")},{default:v(()=>[d(r,{label:n(l)("flashByWhole.burn_all"),value:"Burn"},null,8,["label"]),d(r,{label:n(l)("flashByWhole.erase_all"),value:"Erase"},null,8,["label"])]),_:1},8,["disabled","modelValue","placeholder"])]),E(d(a,{disabled:!$.value.length||m.value,class:"start-flash",onClick:pe},{default:v(()=>[f(c(B.value?n(l)("common.start_flash"):n(l)("common.start_erase")),1)]),_:1},8,["disabled"]),[[N,!m.value]]),E(d(a,{class:"start-flash",onClick:G},{default:v(()=>[f(c(B.value?n(l)("common.cancel_flash"):n(l)("flashByWhole.cancel_erase")),1)]),_:1},512),[[N,m.value]])]),k.value?(_(),b("div",Ge,c(n(l)("flashByWhole.Initializing")),1)):I("",!0),d(ve,{modelValue:D.value,"onUpdate:modelValue":e[2]||(e[2]=s=>D.value=s)},{default:v(()=>[(_(!0),b(U,null,w(i.value[u.value].children,(s,C)=>(_(),x(P,{class:Fe(s.status=="failed"&&"collapse_failed"),key:C,name:C},{title:v(()=>[o("span",Je,c(s.BoardName),1),s.percentage&&s.status!=="failed"?(_(),b("span",Xe,c(s.percentage)+"%",1)):I("",!0),s.percentage&&s.status=="failed"?(_(),b("span",je,c(s.percentage)+"%",1)):I("",!0),s.status!=="failed"?(_(),b("div",{key:2,class:"progress",style:M({width:`${s.percentage}%`})},[E(o("div",He,null,512),[[N,s.percentage!=100]]),E(o("div",Qe,null,512),[[N,s.percentage!=100]])],4)):(_(),b("div",{key:3,class:"progress progress_failed",style:M({width:`${s.percentage}%`})},null,4))]),default:v(()=>[o("div",Ye,[o("div",Ke,c(n(l)("common.transport_channel")),1),o("div",Ze,[o("div",null,[o("span",null,[el,f(" "+c(n(l)("getVerison.board_type")),1)]),f(),ll,d(p,{class:"device",disabled:m.value,"popper-class":"select-class",modelValue:s.SOCType,"onUpdate:modelValue":h=>s.SOCType=h,placeholder:n(l)("common.please_select")},{default:v(()=>[d(r,{label:"A1000B",value:1}),d(r,{label:"C1200",value:2})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),E(o("div",null,[o("span",null,[al,f(" "+c(n(l)("flashByWhole.board_type")),1)]),f(),sl,d(p,{class:"device",disabled:m.value,"popper-class":"select-class",modelValue:s.BoardType,"onUpdate:modelValue":h=>s.BoardType=h,placeholder:n(l)("common.please_select")},{default:v(()=>[d(r,{label:"EVM_LPDDR4X",value:1}),d(r,{label:"EVM_LPDDR5",value:2}),d(r,{label:"CDCU_LPDDR5",value:3})]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])],512),[[N,s.SOCType===2]]),o("div",null,[o("span",null,[ol,f(" "+c(n(l)("common.usb")),1)]),tl,d(p,{class:"usb","popper-class":"select-class",disabled:m.value,modelValue:s.Usb.Value,"onUpdate:modelValue":h=>s.Usb.Value=h,placeholder:n(l)("common.please_select")},{default:v(()=>[d(r,{label:s.SOCType===1?"USB2.0":"Type_C",value:"0"},null,8,["label"]),d(r,{label:s.SOCType===1?"USB3.0":"Type_A",value:"1"},null,8,["label"])]),_:2},1032,["disabled","modelValue","onUpdate:modelValue","placeholder"])]),o("div",null,[o("span",null,[nl,f(" "+c(n(l)("common.serial_port")),1)]),rl,d(a,{onClick:h=>ue(s),disabled:m.value,type:"primary",class:"refresh"},{default:v(()=>[n(ae)?(_(),b("img",{key:0,src:n(we),alt:"",srcset:""},null,8,ul)):(_(),b("span",cl,c(n(l)("common.refresh")),1))]),_:2},1032,["onClick","disabled"]),d(p,{"popper-class":"select-class",clearable:"",disabled:m.value,class:"port",style:M({width:n(se)}),onVisibleChange:h=>ce(h,s.SerialPort.Value),modelValue:s.SerialPort.Value,"onUpdate:modelValue":h=>s.SerialPort.Value=h,onChange:ie,placeholder:n(l)("common.please_select")},{default:v(()=>[(_(!0),b(U,null,w(n(V),h=>(_(),x(r,{disabled:!!h.Disabled,key:h.Value,label:h.Name,value:h.Value},null,8,["disabled","label","value"]))),128))]),_:2},1032,["disabled","style","onVisibleChange","modelValue","onUpdate:modelValue","placeholder"])])])]),S.value==="Burn"?(_(),b("div",il,[dl,o("div",hl,[o("div",pl,[o("span",fl,[_l,f(" "+c(n(l)("flashByWhole.BIN_file")),1)]),d(g,{style:{width:"400px"},modelValue:s.BinFilePath,"onUpdate:modelValue":h=>s.BinFilePath=h,"fetch-suggestions":te,clearable:"",spellcheck:"false","popper-class":"select-class",class:"inline-input w-50",placeholder:n(l)("common.please_input"),onSelect:h=>ne(h,C)},null,8,["modelValue","onUpdate:modelValue","placeholder","onSelect"]),d(a,{disabled:m.value,onClick:h=>he(s)},{default:v(()=>[f(c(n(l)("common.select_file")),1)]),_:2},1032,["disabled","onClick"])])])])):I("",!0)]),_:2},1032,["class","name"]))),128))]),_:1},8,["modelValue"]),d(me,{modelValue:W.value,"onUpdate:modelValue":e[4]||(e[4]=s=>W.value=s),title:B.value?n(l)("flashByWhole.flash_info"):n(l)("flashByWhole.erase_info"),width:"800px",class:"flash-success","close-on-click-modal":!1,"show-close":!1},{footer:v(()=>[o("span",ml,[d(a,{class:"dialog-btn cancel-btn",type:"primary",onClick:e[3]||(e[3]=s=>W.value=!1)},{default:v(()=>[f(c(B.value?n(l)("common.cancel_flash"):n(l)("flashByWhole.cancel_erase")),1)]),_:1}),d(a,{class:"dialog-btn confirm-btn",onClick:_e,type:"primary"},{default:v(()=>[f(c(B.value?n(l)("common.continue_flash"):n(l)("flashByWhole.continue_erase")),1)]),_:1})])]),default:v(()=>[(_(!0),b(U,null,w($.value,(s,C)=>{var h;return _(),b("div",{class:"flash-burn-info",key:C},[o("p",null,"[ "+c(s.BoardName)+" ]",1),o("p",null,[o("span",null,c(n(l)("getVerison.board_type"))+":",1),f(" "+c(s.SOCType===1?"A1000B":"C1200"),1)]),s.SOCType===2?(_(),b("p",vl,[o("span",null,c(n(l)("flashByWhole.board_type"))+":",1),f(" "+c(s.BoardType===1?"EVM_LPDDR4X":s.BoardType===2?"EVM_LPDDR5":"CDCU_LPDDR5"),1)])):I("",!0),o("p",null,[o("span",null,c(n(l)("common.usb"))+":",1),f(" "+c(s.SOCType===1?s.Usb.Value=="0"?"USB2.0":"USB3.0":s.Usb.Value=="0"?"Type_C":"Type_A"),1)]),o("p",null,[o("span",null,c(n(l)("common.serial_port"))+":",1),f(" "+c((h=n(V).find(be=>be.Value===s.SerialPort.Value))==null?void 0:h.Name),1)]),E(o("p",null,[o("span",null,c(n(l)("flashByWhole.BIN_file"))+":",1),f(" "+c(s.BinFilePath),1)],512),[[N,S.value==="Burn"]])])}),128))]),_:1},8,["modelValue","title"])],64)}}});const Sl=We(bl,[["__scopeId","data-v-8523b929"]]);export{Sl as default};
